{"ast":null,"code":"// src/App.js\nimport{useState,useEffect,useRef}from'react';import{MantineProvider,Card,Text,Button,TextInput,Paper,ActionIcon,Group}from'@mantine/core';import{IconX,IconMessageCircle}from'@tabler/icons-react';// Иконки для кнопок\nimport axios from'axios';// URL нашего бэкенда (не меняются)\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL='http://localhost:8000/api/hello';const WS_URL='ws://localhost:8000/ws';// === Основной компонент виджета (сам чат) ===\nfunction ChatWidget(_ref){let{onClose}=_ref;const[apiMessage,setApiMessage]=useState('Загрузка...');const[wsMessages,setWsMessages]=useState([]);const[inputValue,setInputValue]=useState('');const socket=useRef(null);// Загружаем данные по HTTP и подключаемся к WebSocket\nuseEffect(()=>{// Запрос по HTTP\naxios.get(API_URL).then(response=>setApiMessage(response.data.message)).catch(error=>setApiMessage('Ошибка загрузки :('));// Подключение к WebSocket\nsocket.current=new WebSocket(WS_URL);socket.current.onopen=()=>console.log('WS соединение установлено');socket.current.onmessage=event=>{setWsMessages(prev=>[...prev,event.data]);};socket.current.onclose=()=>console.log('WS соединение закрыто');// Чистка при закрытии виджета\nreturn()=>{if(socket.current){socket.current.close();}};},[]);const sendMessage=()=>{if(inputValue&&socket.current.readyState===WebSocket.OPEN){socket.current.send(inputValue);setInputValue('');}};return/*#__PURE__*/_jsxs(Card,{shadow:\"xl\",p:\"lg\",radius:\"md\",withBorder:true,style:{width:350},children:[/*#__PURE__*/_jsxs(Group,{position:\"apart\",mb:\"md\",children:[/*#__PURE__*/_jsx(Text,{weight:500,children:\"\\u0427\\u0430\\u0442-\\u0432\\u0438\\u0434\\u0436\\u0435\\u0442\"}),/*#__PURE__*/_jsx(ActionIcon,{onClick:onClose,children:/*#__PURE__*/_jsx(IconX,{size:16})})]}),/*#__PURE__*/_jsxs(Text,{size:\"sm\",color:\"dimmed\",children:[\"\\u0421\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435 (HTTP): \",/*#__PURE__*/_jsx(\"b\",{children:apiMessage})]}),/*#__PURE__*/_jsx(TextInput,{placeholder:\"\\u0412\\u0430\\u0448\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435...\",value:inputValue,onChange:event=>setInputValue(event.currentTarget.value),mt:\"md\"}),/*#__PURE__*/_jsx(Button,{onClick:sendMessage,mt:\"sm\",fullWidth:true,children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(Text,{size:\"sm\",mt:\"lg\",children:\"\\u041E\\u0442\\u0432\\u0435\\u0442\\u044B \\u043E\\u0442 WebSocket:\"}),/*#__PURE__*/_jsx(Paper,{withBorder:true,p:\"xs\",mt:\"xs\",style:{height:120,overflowY:'auto'},children:wsMessages.length===0?/*#__PURE__*/_jsx(Text,{size:\"xs\",color:\"dimmed\",children:\"\\u0416\\u0434\\u0435\\u043C \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439...\"}):wsMessages.map((msg,index)=>/*#__PURE__*/_jsx(Text,{size:\"xs\",children:msg},index))})]});}// === Компонент-обертка, который управляет состоянием ===\nfunction App(){// Состояние для открытия/закрытия виджета\nconst[isOpen,setIsOpen]=useState(false);// Стили для позиционирования в углу экрана\nconst widgetContainerStyle={position:'fixed',bottom:'20px',right:'20px',zIndex:1000// Чтобы было поверх всего\n};return/*#__PURE__*/_jsx(\"div\",{style:widgetContainerStyle,children:isOpen?/*#__PURE__*/// Если открыто - показываем сам виджет\n_jsx(ChatWidget,{onClose:()=>setIsOpen(false)}):/*#__PURE__*/// Если закрыто - показываем кнопку для открытия\n_jsx(Button,{onClick:()=>setIsOpen(true),radius:\"xl\",size:\"lg\",shadow:\"xl\",leftIcon:/*#__PURE__*/_jsx(IconMessageCircle,{size:24}),children:\"Click ME\"})});}// Оборачиваем App в MantineProvider, как и раньше\nexport default function MantineApp(){return/*#__PURE__*/_jsx(MantineProvider,{withGlobalStyles:true,withNormalizeCSS:true,children:/*#__PURE__*/_jsx(App,{})});}","map":{"version":3,"names":["useState","useEffect","useRef","MantineProvider","Card","Text","Button","TextInput","Paper","ActionIcon","Group","IconX","IconMessageCircle","axios","jsx","_jsx","jsxs","_jsxs","API_URL","WS_URL","ChatWidget","_ref","onClose","apiMessage","setApiMessage","wsMessages","setWsMessages","inputValue","setInputValue","socket","get","then","response","data","message","catch","error","current","WebSocket","onopen","console","log","onmessage","event","prev","onclose","close","sendMessage","readyState","OPEN","send","shadow","p","radius","withBorder","style","width","children","position","mb","weight","onClick","size","color","placeholder","value","onChange","currentTarget","mt","fullWidth","height","overflowY","length","map","msg","index","App","isOpen","setIsOpen","widgetContainerStyle","bottom","right","zIndex","leftIcon","MantineApp","withGlobalStyles","withNormalizeCSS"],"sources":["/Users/ansarzeinulla/Desktop/negro/widget-frontend/src/App.js"],"sourcesContent":["// src/App.js\nimport { useState, useEffect, useRef } from 'react';\nimport { MantineProvider, Card, Text, Button, TextInput, Paper, ActionIcon, Group } from '@mantine/core';\nimport { IconX, IconMessageCircle } from '@tabler/icons-react'; // Иконки для кнопок\nimport axios from 'axios';\n\n// URL нашего бэкенда (не меняются)\nconst API_URL = 'http://localhost:8000/api/hello';\nconst WS_URL = 'ws://localhost:8000/ws';\n\n// === Основной компонент виджета (сам чат) ===\nfunction ChatWidget({ onClose }) {\n  const [apiMessage, setApiMessage] = useState('Загрузка...');\n  const [wsMessages, setWsMessages] = useState([]);\n  const [inputValue, setInputValue] = useState('');\n  const socket = useRef(null);\n\n  // Загружаем данные по HTTP и подключаемся к WebSocket\n  useEffect(() => {\n    // Запрос по HTTP\n    axios.get(API_URL)\n      .then(response => setApiMessage(response.data.message))\n      .catch(error => setApiMessage('Ошибка загрузки :('));\n\n    // Подключение к WebSocket\n    socket.current = new WebSocket(WS_URL);\n    socket.current.onopen = () => console.log('WS соединение установлено');\n    socket.current.onmessage = (event) => {\n      setWsMessages(prev => [...prev, event.data]);\n    };\n    socket.current.onclose = () => console.log('WS соединение закрыто');\n\n    // Чистка при закрытии виджета\n    return () => {\n      if (socket.current) {\n        socket.current.close();\n      }\n    };\n  }, []);\n\n  const sendMessage = () => {\n    if (inputValue && socket.current.readyState === WebSocket.OPEN) {\n      socket.current.send(inputValue);\n      setInputValue('');\n    }\n  };\n\n  return (\n    <Card shadow=\"xl\" p=\"lg\" radius=\"md\" withBorder style={{ width: 350 }}>\n      <Group position=\"apart\" mb=\"md\">\n        <Text weight={500}>Чат-виджет</Text>\n        <ActionIcon onClick={onClose}>\n          <IconX size={16} />\n        </ActionIcon>\n      </Group>\n\n      <Text size=\"sm\" color=\"dimmed\">\n        Сообщение (HTTP): <b>{apiMessage}</b>\n      </Text>\n\n      <TextInput\n        placeholder=\"Ваше сообщение...\"\n        value={inputValue}\n        onChange={(event) => setInputValue(event.currentTarget.value)}\n        mt=\"md\"\n      />\n      <Button onClick={sendMessage} mt=\"sm\" fullWidth>\n        Отправить\n      </Button>\n\n      <Text size=\"sm\" mt=\"lg\">Ответы от WebSocket:</Text>\n      <Paper withBorder p=\"xs\" mt=\"xs\" style={{ height: 120, overflowY: 'auto' }}>\n        {wsMessages.length === 0 \n          ? <Text size=\"xs\" color=\"dimmed\">Ждем сообщений...</Text>\n          : wsMessages.map((msg, index) => <Text key={index} size=\"xs\">{msg}</Text>)\n        }\n      </Paper>\n    </Card>\n  );\n}\n\n\n// === Компонент-обертка, который управляет состоянием ===\nfunction App() {\n  // Состояние для открытия/закрытия виджета\n  const [isOpen, setIsOpen] = useState(false);\n\n  // Стили для позиционирования в углу экрана\n  const widgetContainerStyle = {\n    position: 'fixed',\n    bottom: '20px',\n    right: '20px',\n    zIndex: 1000, // Чтобы было поверх всего\n  };\n\n  return (\n    <div style={widgetContainerStyle}>\n      {isOpen ? (\n        // Если открыто - показываем сам виджет\n        <ChatWidget onClose={() => setIsOpen(false)} />\n      ) : (\n        // Если закрыто - показываем кнопку для открытия\n        <Button\n          onClick={() => setIsOpen(true)}\n          radius=\"xl\"\n          size=\"lg\"\n          shadow=\"xl\"\n          leftIcon={<IconMessageCircle size={24} />}\n        >\n          Click ME\n        </Button>\n      )}\n    </div>\n  );\n}\n\n// Оборачиваем App в MantineProvider, как и раньше\nexport default function MantineApp() {\n  return (\n    <MantineProvider withGlobalStyles withNormalizeCSS>\n      <App />\n    </MantineProvider>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}