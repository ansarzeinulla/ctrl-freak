
<!-- index.html (ФИНАЛЬНАЯ ВЕРСИЯ) -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Страница с виджетом и авторизацией</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #login-form { border: 1px solid #ccc; padding: 20px; max-width: 300px; }
        #login-form input { display: block; width: 95%; padding: 8px; margin-bottom: 10px; }
        #login-form button { padding: 10px 15px; }
        #auth-status { margin-top: 20px; }
        #logout-button { display: none; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Это моя крутая страница</h1>
    <p>Просто какой-то контент. Можно скроллить вниз.</p>
    <p>Кнопка виджета должна быть всегда видна в правом нижнем углу.</p>

    <div id="auth-container">
        <div id="login-form">
            <h3>Войдите для доступа к виджету</h3>
            <input type="text" id="username" placeholder="Логин (admin)">
            <input type="password" id="password" placeholder="Пароль (12345678)">
            <button id="login-button">Войти</button>
            <p id="error-message" class="error"></p>
        </div>

        <div id="auth-status">
            <p>Статус: <span id="status-text">Не авторизован</span></p>
            <button id="logout-button">Выйти</button>
        </div>
    </div>

    <!-- Добавляем скрытое поле с ID вакансии. Виджет будет его читать. -->
    <input type="hidden" id="vacancy-id" value="12">
    <input type="hidden" id="resume-id" value="12">

    <!-- React сам создаст кнопку и встроит ее сюда -->
    <div id="root"></div>

    <script>
        // --- JWT Simulation & Auth Logic ---

        const WIDGET_SCRIPT_SRC = '../widget-frontend/build/static/js/main.d76e0ac6.js'; // ЗАМЕНИТЬ ИМЯ ФАЙЛА

        // In a real application, the token is generated by the server with a secret key.
        // Here, we simulate it for demonstration purposes.
        function createFakeJwt(username) {
            const header = { alg: 'HS256', typ: 'JWT' };
            const payload = { sub: username, iat: Date.now() };
            // A real signature cannot be securely created on the client. We'll use a fake one.
            const signature = 'fake-signature-because-client-side';

            return [btoa(JSON.stringify(header)), btoa(JSON.stringify(payload)), signature].join('.');
        }

        function loadWidget() {
            // Check if the script is already loaded
            if (document.querySelector(`script[src="${WIDGET_SCRIPT_SRC}"]`)) {
                console.log('Widget script already loaded.');
                return;
            }
            console.log('Loading widget script...');
            const script = document.createElement('script');
            script.src = WIDGET_SCRIPT_SRC;
            script.async = true;
            document.body.appendChild(script);
        }

        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorEl = document.getElementById('error-message');

            if (username === 'admin' && password === '12345678') {
                const token = createFakeJwt(username);
                localStorage.setItem('jwt_token', token);
                errorEl.textContent = '';
                updateUI(true);
                loadWidget();
            } else {
                errorEl.textContent = 'Неверный логин или пароль.';
            }
        }

        function handleLogout() {
            localStorage.removeItem('jwt_token');
            // Reloading is the simplest way to reset the state and remove the widget
            window.location.reload();
        }

        function updateUI(isAuthorized) {
            document.getElementById('login-form').style.display = isAuthorized ? 'none' : 'block';
            document.getElementById('logout-button').style.display = isAuthorized ? 'block' : 'none';
            document.getElementById('status-text').textContent = isAuthorized ? 'Авторизован' : 'Не авторизован';
        }

        // --- Event Listeners & Initial Check ---
        document.getElementById('login-button').addEventListener('click', handleLogin);
        document.getElementById('logout-button').addEventListener('click', handleLogout);

        // On page load, check if user is already logged in
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('jwt_token');
            if (token) {
                // In a real app, you'd verify the token with the server here.
                // For our simulation, just its presence is enough.
                console.log('Found token, user is authorized.');
                updateUI(true);
                loadWidget();
            } else {
                console.log('No token found, user is not authorized.');
                updateUI(false);
            }
        });
    </script>
</body>
</html>
